"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.isDependencyAllowed = void 0;
const wildcard_to_regex_1 = require("../util/wildcard-to-regex");
const user_error_1 = require("../error/user-error");
const isDependencyAllowed = (from, tos, config, context) => {
    let isAllowed;
    isAllowed = undefined;
    for (const tag in config) {
        if (from.match((0, wildcard_to_regex_1.wildcardToRegex)(tag))) {
            for (const to of tos) {
                const value = config[tag];
                const matchers = Array.isArray(value) ? value : [value];
                for (const matcher of matchers) {
                    if (typeof matcher === 'string' &&
                        to.match((0, wildcard_to_regex_1.wildcardToRegex)(matcher))) {
                        return true;
                    }
                    else if (typeof matcher === 'function' &&
                        matcher(Object.assign({ from, to }, context))) {
                        return true;
                    }
                }
            }
            isAllowed = false;
        }
    }
    if (isAllowed === undefined) {
        throw new user_error_1.NoDependencyRuleForTagError(from);
    }
    return false;
};
exports.isDependencyAllowed = isDependencyAllowed;
//# sourceMappingURL=is-dependency-allowed.js.map