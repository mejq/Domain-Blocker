"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.loadFederationConfig = loadFederationConfig;
const tslib_1 = require("tslib");
const path = tslib_1.__importStar(require("path"));
const fs = tslib_1.__importStar(require("fs"));
const remove_unused_deps_1 = require("./remove-unused-deps");
function loadFederationConfig(fedOptions) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        var _a;
        const fullConfigPath = path.join(fedOptions.workspaceRoot, fedOptions.federationConfig);
        if (!fs.existsSync(fullConfigPath)) {
            throw new Error('Expected ' + fullConfigPath);
        }
        const config = (yield Promise.resolve(`${fullConfigPath}`).then(s => tslib_1.__importStar(require(s))));
        if (config.features.ignoreUnusedDeps && !fedOptions.entryPoint) {
            throw new Error(`The feature ignoreUnusedDeps needs the application's entry point. Please set it in your federation options!`);
        }
        if (config.features.ignoreUnusedDeps) {
            return (0, remove_unused_deps_1.removeUnusedDeps)(config, (_a = fedOptions.entryPoint) !== null && _a !== void 0 ? _a : '', fedOptions.workspaceRoot);
        }
        return config;
    });
}
//# sourceMappingURL=load-federation-config.js.map